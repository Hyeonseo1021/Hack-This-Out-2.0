/**
 * Vulnerability Scanner Race - Seed Script
 *
 * EASY ë‚œì´ë„ í•™ìŠµìš© ì‹œë‚˜ë¦¬ì˜¤
 * ì‹¤í–‰: npx ts-node src/scripts/seedVulnerabilityScannerScenarios.ts
 */

import mongoose from 'mongoose';
import dotenv from 'dotenv';
import path from 'path';

// Load environment variables
dotenv.config({ path: path.join(__dirname, '../../.env') });

import ArenaScenario from '../models/ArenaScenario';

const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/hackthisout';

/**
 * EASY ë‚œì´ë„ ì‹œë‚˜ë¦¬ì˜¤ #1: ì›¹ ë¡œê·¸ì¸ í˜ì´ì§€ (SQL Injection + XSS)
 *
 * í•™ìŠµ ëª©í‘œ:
 * - SQL Injectionì˜ ê¸°ë³¸ ì›ë¦¬ ì´í•´ (' OR '1'='1 íŒ¨í„´)
 * - Reflected XSSì˜ ê¸°ë³¸ ì›ë¦¬ ì´í•´ (<script>alert()</script>)
 */
const scenario1_LoginPage = {
  mode: 'VULNERABILITY_SCANNER_RACE' as const,
  difficulty: 'EASY' as const,
  title: {
    ko: 'ì·¨ì•½í•œ ë¡œê·¸ì¸ í˜ì´ì§€',
    en: 'Vulnerable Login Page'
  },
  description: {
    ko: 'ê¸°ë³¸ì ì¸ SQL Injectionê³¼ XSS ì·¨ì•½ì ì´ ìˆëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤. ì¸ì¦ì„ ìš°íšŒí•˜ê³  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ë³´ì„¸ìš”.',
    en: 'A login page with basic SQL Injection and XSS vulnerabilities. Try to bypass authentication and execute scripts.'
  },
  timeLimit: 600, // 10ë¶„
  data: {
    mode: 'SIMULATED',
    targetName: {
      ko: 'SecureBank ë¡œê·¸ì¸',
      en: 'SecureBank Login'
    },
    targetDescription: {
      ko: 'ì€í–‰ ë¡œê·¸ì¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë³´ì•ˆ ì·¨ì•½ì ì„ ì°¾ì•„ ì¸ì¦ì„ ìš°íšŒí•´ë³´ì„¸ìš”.',
      en: 'A bank login system. Find security vulnerabilities and bypass authentication.'
    },
    features: ['Login Form', 'Search Box', 'User Registration'],
    vulnerabilities: [
      {
        vulnId: 'vuln_sqli_login_001',
        vulnType: 'SQLi',
        vulnName: {
          ko: 'SQL Injection - ë¡œê·¸ì¸ ìš°íšŒ',
          en: 'SQL Injection - Login Bypass'
        },
        flag: 'FLAG{SQLi_login_bypass_easy_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Authentication'
      },
      {
        vulnId: 'vuln_xss_search_001',
        vulnType: 'XSS',
        vulnName: {
          ko: 'Reflected XSS - ê²€ìƒ‰ì°½',
          en: 'Reflected XSS - Search Box'
        },
        flag: 'FLAG{XSS_reflected_easy_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Input Validation'
      }
    ],
    hints: [
      {
        hintId: 'hint_sqli_1',
        vulnId: 'vuln_sqli_login_001',
        level: 1,
        content: {
          ko: 'SQL ì¿¼ë¦¬ëŠ” ë³´í†µ SELECT * FROM users WHERE username=\'ì…ë ¥ê°’\' AND password=\'ì…ë ¥ê°’\' í˜•íƒœì…ë‹ˆë‹¤.',
          en: 'SQL queries usually look like: SELECT * FROM users WHERE username=\'input\' AND password=\'input\''
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_sqli_2',
        vulnId: 'vuln_sqli_login_001',
        level: 2,
        content: {
          ko: 'ì‘ì€ë”°ì˜´í‘œ(\')ë¥¼ ì‚¬ìš©í•´ ë¬¸ìì—´ì„ ì¢…ë£Œí•˜ê³  OR ì¡°ê±´ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.',
          en: 'Try using a single quote (\') to end the string and add an OR condition.'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_sqli_3',
        vulnId: 'vuln_sqli_login_001',
        level: 3,
        content: {
          ko: 'ì •ë‹µ ì˜ˆì‹œ: \' OR \'1\'=\'1 ë˜ëŠ” admin\'--',
          en: 'Example answer: \' OR \'1\'=\'1 or admin\'--'
        },
        pointPenalty: 40
      },
      {
        hintId: 'hint_xss_1',
        vulnId: 'vuln_xss_search_001',
        level: 1,
        content: {
          ko: 'ê²€ìƒ‰ ê²°ê³¼ê°€ í˜ì´ì§€ì— ê·¸ëŒ€ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check if the search input is displayed directly on the page.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_xss_2',
        vulnId: 'vuln_xss_search_001',
        level: 2,
        content: {
          ko: 'HTML íƒœê·¸ë¥¼ ì…ë ¥í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? <b>test</b>ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.',
          en: 'What happens if you enter HTML tags? Try <b>test</b>.'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_xss_3',
        vulnId: 'vuln_xss_search_001',
        level: 3,
        content: {
          ko: 'ì •ë‹µ ì˜ˆì‹œ: <script>alert(1)</script>',
          en: 'Example answer: <script>alert(1)</script>'
        },
        pointPenalty: 40
      }
    ]
  },
  isActive: true
};

/**
 * EASY ë‚œì´ë„ ì‹œë‚˜ë¦¬ì˜¤ #2: ì‚¬ìš©ì í”„ë¡œí•„ í˜ì´ì§€ (IDOR + CSRF)
 *
 * í•™ìŠµ ëª©í‘œ:
 * - IDOR (Insecure Direct Object Reference) ì´í•´
 * - CSRF (Cross-Site Request Forgery) ê¸°ë³¸ ê°œë…
 */
const scenario2_ProfilePage = {
  mode: 'VULNERABILITY_SCANNER_RACE' as const,
  difficulty: 'EASY' as const,
  title: {
    ko: 'ì·¨ì•½í•œ í”„ë¡œí•„ í˜ì´ì§€',
    en: 'Vulnerable Profile Page'
  },
  description: {
    ko: 'IDORì™€ CSRF ì·¨ì•½ì ì´ ìˆëŠ” í”„ë¡œí•„ í˜ì´ì§€ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì •ë³´ì— ì ‘ê·¼í•´ë³´ì„¸ìš”.',
    en: 'A profile page with IDOR and CSRF vulnerabilities. Try to access other users\' information.'
  },
  timeLimit: 600,
  data: {
    mode: 'SIMULATED',
    targetName: {
      ko: 'SocialHub í”„ë¡œí•„',
      en: 'SocialHub Profile'
    },
    targetDescription: {
      ko: 'ì†Œì…œ ë„¤íŠ¸ì›Œí¬ í”„ë¡œí•„ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì ‘ê·¼ ì œì–´ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ì„¸ìš”.',
      en: 'A social network profile system. Find access control vulnerabilities.'
    },
    features: ['Profile View', 'Profile Edit', 'User Search'],
    vulnerabilities: [
      {
        vulnId: 'vuln_idor_profile_001',
        vulnType: 'IDOR',
        vulnName: {
          ko: 'IDOR - ë‹¤ë¥¸ ì‚¬ìš©ì í”„ë¡œí•„ ì ‘ê·¼',
          en: 'IDOR - Access Other User Profile'
        },
        flag: 'FLAG{IDOR_profile_access_easy_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Access Control'
      },
      {
        vulnId: 'vuln_csrf_profile_001',
        vulnType: 'CSRF',
        vulnName: {
          ko: 'CSRF - í”„ë¡œí•„ ìˆ˜ì •',
          en: 'CSRF - Profile Modification'
        },
        flag: 'FLAG{CSRF_no_token_easy_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Session Management'
      }
    ],
    hints: [
      {
        hintId: 'hint_idor_1',
        vulnId: 'vuln_idor_profile_001',
        level: 1,
        content: {
          ko: 'URLì— ìˆëŠ” ì‚¬ìš©ì ID íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check the user ID parameter in the URL.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_idor_2',
        vulnId: 'vuln_idor_profile_001',
        level: 2,
        content: {
          ko: 'í˜„ì¬ ì‚¬ìš©ì IDê°€ 1001ì´ë¼ë©´, ë‹¤ë¥¸ ìˆ«ìë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.',
          en: 'If your current user ID is 1001, try other numbers.'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_idor_3',
        vulnId: 'vuln_idor_profile_001',
        level: 3,
        content: {
          ko: 'ì •ë‹µ: user_id=1002 ë˜ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ì IDë¡œ ë³€ê²½',
          en: 'Answer: Change to user_id=1002 or another user ID'
        },
        pointPenalty: 40
      },
      {
        hintId: 'hint_csrf_1',
        vulnId: 'vuln_csrf_profile_001',
        level: 1,
        content: {
          ko: 'í”„ë¡œí•„ ìˆ˜ì • í¼ì— CSRF í† í°ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check if there is a CSRF token in the profile edit form.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_csrf_2',
        vulnId: 'vuln_csrf_profile_001',
        level: 2,
        content: {
          ko: 'CSRF í† í° ì—†ì´ í¼ì„ ì œì¶œí•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?',
          en: 'What happens if you submit the form without a CSRF token?'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_csrf_3',
        vulnId: 'vuln_csrf_profile_001',
        level: 3,
        content: {
          ko: 'ì •ë‹µ: í”„ë¡œí•„ ìˆ˜ì • í¼ì„ ê·¸ëƒ¥ ì œì¶œí•˜ë©´ CSRF ê²€ì¦ ì—†ì´ ì„±ê³µí•©ë‹ˆë‹¤.',
          en: 'Answer: Just submit the profile edit form - it succeeds without CSRF validation.'
        },
        pointPenalty: 40
      }
    ]
  },
  isActive: true
};

/**
 * EASY ë‚œì´ë„ ì‹œë‚˜ë¦¬ì˜¤ #3: íŒŒì¼ ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ (Path Traversal)
 *
 * í•™ìŠµ ëª©í‘œ:
 * - Path Traversal (Directory Traversal) ê³µê²© ì´í•´
 * - ../ íŒ¨í„´ì„ ì‚¬ìš©í•œ íŒŒì¼ ì‹œìŠ¤í…œ íƒìƒ‰
 */
const scenario3_FileDownload = {
  mode: 'VULNERABILITY_SCANNER_RACE' as const,
  difficulty: 'EASY' as const,
  title: {
    ko: 'ì·¨ì•½í•œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ',
    en: 'Vulnerable File Download'
  },
  description: {
    ko: 'Path Traversal ì·¨ì•½ì ì´ ìˆëŠ” íŒŒì¼ ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œ íŒŒì¼ì— ì ‘ê·¼í•´ë³´ì„¸ìš”.',
    en: 'A file download page with Path Traversal vulnerability. Try to access system files.'
  },
  timeLimit: 600,
  data: {
    mode: 'SIMULATED',
    targetName: {
      ko: 'CloudDrive íŒŒì¼ ê´€ë¦¬ì',
      en: 'CloudDrive File Manager'
    },
    targetDescription: {
      ko: 'í´ë¼ìš°ë“œ íŒŒì¼ ì €ì¥ì†Œì…ë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œ ì²˜ë¦¬ì˜ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ì„¸ìš”.',
      en: 'A cloud file storage. Find vulnerabilities in file path handling.'
    },
    features: ['File List', 'File Download', 'File Upload'],
    vulnerabilities: [
      {
        vulnId: 'vuln_path_traversal_001',
        vulnType: 'PATH_TRAVERSAL',
        vulnName: {
          ko: 'Path Traversal - ì‹œìŠ¤í…œ íŒŒì¼ ì ‘ê·¼',
          en: 'Path Traversal - System File Access'
        },
        flag: 'FLAG{PATH_TRAVERSAL_easy_001}',
        difficulty: 'EASY',
        basePoints: 150,
        category: 'File Handling'
      }
    ],
    hints: [
      {
        hintId: 'hint_path_1',
        vulnId: 'vuln_path_traversal_001',
        level: 1,
        content: {
          ko: 'íŒŒì¼ ë‹¤ìš´ë¡œë“œ URLì˜ íŒŒì¼ëª… íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check the filename parameter in the download URL.'
        },
        pointPenalty: 15
      },
      {
        hintId: 'hint_path_2',
        vulnId: 'vuln_path_traversal_001',
        level: 2,
        content: {
          ko: '../ ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒìœ„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
          en: 'You can use ../ to navigate to parent directories.'
        },
        pointPenalty: 30
      },
      {
        hintId: 'hint_path_3',
        vulnId: 'vuln_path_traversal_001',
        level: 3,
        content: {
          ko: 'ì •ë‹µ ì˜ˆì‹œ: ../../../etc/passwd ë˜ëŠ” ....//....//etc/passwd',
          en: 'Example answer: ../../../etc/passwd or ....//....//etc/passwd'
        },
        pointPenalty: 50
      }
    ]
  },
  isActive: true
};

/**
 * EASY ë‚œì´ë„ ì‹œë‚˜ë¦¬ì˜¤ #4: ì¢…í•© ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ (SQLi + XSS + IDOR)
 *
 * í•™ìŠµ ëª©í‘œ:
 * - ì—¬ëŸ¬ ì·¨ì•½ì ì„ ë™ì‹œì— ì°¾ëŠ” ì—°ìŠµ
 * - ì‹¤ì œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìœ ì‚¬í•œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
 */
const scenario4_EcommerceApp = {
  mode: 'VULNERABILITY_SCANNER_RACE' as const,
  difficulty: 'EASY' as const,
  title: {
    ko: 'ì·¨ì•½í•œ ì‡¼í•‘ëª°',
    en: 'Vulnerable E-commerce'
  },
  description: {
    ko: 'ì—¬ëŸ¬ ì·¨ì•½ì ì´ ìˆ¨ê²¨ì§„ ì‡¼í•‘ëª°ì…ë‹ˆë‹¤. SQL Injection, XSS, IDORì„ ëª¨ë‘ ì°¾ì•„ë³´ì„¸ìš”.',
    en: 'An e-commerce site with multiple hidden vulnerabilities. Find SQL Injection, XSS, and IDOR.'
  },
  timeLimit: 900, // 15ë¶„ (ì·¨ì•½ì ì´ ë§ì•„ì„œ)
  data: {
    mode: 'SIMULATED',
    targetName: {
      ko: 'HackMart ì‡¼í•‘ëª°',
      en: 'HackMart Shopping'
    },
    targetDescription: {
      ko: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì…ë‹ˆë‹¤. ë¡œê·¸ì¸, ìƒí’ˆ ê²€ìƒ‰, ì£¼ë¬¸ ë‚´ì—­ì—ì„œ ì·¨ì•½ì ì„ ì°¾ì•„ë³´ì„¸ìš”.',
      en: 'An online shopping mall. Find vulnerabilities in login, product search, and order history.'
    },
    features: ['Login', 'Product Search', 'Order History', 'User Profile'],
    vulnerabilities: [
      {
        vulnId: 'vuln_sqli_ecom_001',
        vulnType: 'SQLi',
        vulnName: {
          ko: 'SQL Injection - ë¡œê·¸ì¸',
          en: 'SQL Injection - Login'
        },
        flag: 'FLAG{SQLi_ecommerce_login_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Authentication'
      },
      {
        vulnId: 'vuln_xss_ecom_001',
        vulnType: 'XSS',
        vulnName: {
          ko: 'Reflected XSS - ìƒí’ˆ ê²€ìƒ‰',
          en: 'Reflected XSS - Product Search'
        },
        flag: 'FLAG{XSS_ecommerce_search_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Input Validation'
      },
      {
        vulnId: 'vuln_idor_ecom_001',
        vulnType: 'IDOR',
        vulnName: {
          ko: 'IDOR - ë‹¤ë¥¸ ì‚¬ìš©ì ì£¼ë¬¸ ë‚´ì—­',
          en: 'IDOR - Other User Orders'
        },
        flag: 'FLAG{IDOR_ecommerce_orders_001}',
        difficulty: 'EASY',
        basePoints: 100,
        category: 'Access Control'
      }
    ],
    hints: [
      {
        hintId: 'hint_sqli_ecom_1',
        vulnId: 'vuln_sqli_ecom_001',
        level: 1,
        content: {
          ko: 'ë¡œê·¸ì¸ í¼ì—ì„œ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.',
          en: 'Try entering special characters in the login form.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_sqli_ecom_2',
        vulnId: 'vuln_sqli_ecom_001',
        level: 2,
        content: {
          ko: '\' OR 1=1-- íŒ¨í„´ì„ ì‹œë„í•´ë³´ì„¸ìš”.',
          en: 'Try the \' OR 1=1-- pattern.'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_xss_ecom_1',
        vulnId: 'vuln_xss_ecom_001',
        level: 1,
        content: {
          ko: 'ìƒí’ˆ ê²€ìƒ‰ ê²°ê³¼ê°€ ì–´ë–»ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check how search results are displayed.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_xss_ecom_2',
        vulnId: 'vuln_xss_ecom_001',
        level: 2,
        content: {
          ko: '<script> íƒœê·¸ê°€ í•„í„°ë§ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check if <script> tags are filtered.'
        },
        pointPenalty: 20
      },
      {
        hintId: 'hint_idor_ecom_1',
        vulnId: 'vuln_idor_ecom_001',
        level: 1,
        content: {
          ko: 'ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€ì˜ URLì„ í™•ì¸í•´ë³´ì„¸ìš”.',
          en: 'Check the URL of the order history page.'
        },
        pointPenalty: 10
      },
      {
        hintId: 'hint_idor_ecom_2',
        vulnId: 'vuln_idor_ecom_001',
        level: 2,
        content: {
          ko: 'order_idë‚˜ user_id íŒŒë¼ë¯¸í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.',
          en: 'Try changing the order_id or user_id parameter.'
        },
        pointPenalty: 20
      }
    ]
  },
  isActive: true
};

const scenarios = [
  scenario1_LoginPage,
  scenario2_ProfilePage,
  scenario3_FileDownload,
  scenario4_EcommerceApp
];

async function seedScenarios() {
  try {
    console.log('ğŸ”Œ Connecting to MongoDB...');
    await mongoose.connect(MONGODB_URI);
    console.log('âœ… Connected to MongoDB');

    // ê¸°ì¡´ VULNERABILITY_SCANNER_RACE ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ
    console.log('\nğŸ—‘ï¸  Deleting existing VULNERABILITY_SCANNER_RACE scenarios...');
    const deleteResult = await ArenaScenario.deleteMany({
      mode: 'VULNERABILITY_SCANNER_RACE'
    });
    console.log(`   Deleted ${deleteResult.deletedCount} scenarios`);

    // ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€
    console.log('\nğŸ“ Creating new scenarios...');
    for (const scenario of scenarios) {
      const created = await ArenaScenario.create(scenario);
      console.log(`   âœ… Created: ${scenario.title.en} (${scenario.difficulty})`);
      console.log(`      ID: ${created._id}`);
      console.log(`      Vulnerabilities: ${scenario.data.vulnerabilities.length}`);
    }

    console.log('\nğŸ‰ Seed completed successfully!');
    console.log(`   Total scenarios created: ${scenarios.length}`);

  } catch (error) {
    console.error('âŒ Seed failed:', error);
  } finally {
    await mongoose.disconnect();
    console.log('\nğŸ”Œ Disconnected from MongoDB');
  }
}

// ì§ì ‘ ì‹¤í–‰ ì‹œ
seedScenarios();
