import React, { useEffect, useState, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { toast } from 'react-toastify';
import socket from '../../utils/socket';
import { usePlayContext } from '../../contexts/PlayContext';
import '../../assets/scss/arena/VulnerabilityScannerRace.scss';

interface Hint {
  hintId: string;
  vulnId: string;
  level: 1 | 2 | 3;
  text: string | { ko: string; en: string };
}

interface Vulnerability {
  vulnId: string;
  name: string;
  type: string;
  severity: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW';
  points: number;
  discoveredBy?: string;
  discoveredByUsername?: string;
  isFirstBlood?: boolean;
  hintIds?: string[];
}

interface Player {
  userId: string;
  username: string;
  score: number;
  vulnerabilitiesFound: number;
}

interface GameState {
  targetUrl: string;
  targetName: string | { ko: string; en: string };
  targetDescription: string | { ko: string; en: string };
  mode: 'SIMULATED' | 'REAL';
  vulnerableHTML: string;
  vulnerabilities: Vulnerability[];
  hints?: Hint[];
  leaderboard: Player[];
  myProgress: {
    score: number;
    foundVulnerabilities: string[];
    rank: number;
  };
}

interface VulnerabilityScannerRaceProps {
  arenaId: string;
  userId: string;
}

const VulnerabilityScannerRace: React.FC<VulnerabilityScannerRaceProps> = ({
  arenaId,
  userId: _userId
}) => {
  const navigate = useNavigate();
  const { t, i18n } = useTranslation('arena');
  const iframeRef = useRef<HTMLIFrameElement>(null);
  const iframeLoadedRef = useRef(false);

  const { availableHints, setAvailableHints } = usePlayContext();

  const [loading, setLoading] = useState(true);
  const [gameState, setGameState] = useState<GameState | null>(null);

  const [vulnType, setVulnType] = useState('');
  const [endpoint, setEndpoint] = useState('');
  const [parameter, setParameter] = useState('');
  const [payload, setPayload] = useState('');
  const [submitting, setSubmitting] = useState(false);
  const alertShownRef = useRef(false);

  const [revealedHints, setRevealedHints] = useState<Map<string, number>>(new Map());

  const [isCompleted, setIsCompleted] = useState(false);
  const completedShownRef = useRef(false);
  const isCompletedRef = useRef(false); // âœ… ì™„ë£Œ ì—¬ë¶€ ì¶”ì ìš© ref
  const [allCompleted, setAllCompleted] = useState(false); // âœ… ëª¨ë“  í”Œë ˆì´ì–´ ì™„ë£Œ ìƒíƒœ

  /* ------------------------------------------------------------------
     ëª¨ë“  Hookì„ returnë³´ë‹¤ ìœ„ì— ë°°ì¹˜ (Hook ìˆœì„œ ì˜¤ë¥˜ í•´ê²° í•µì‹¬)
  ------------------------------------------------------------------ */

  // ğŸ”¹ ì´ˆê¸° ìƒíƒœ ìš”ì²­ ë° ì†Œì¼“ ì´ë²¤íŠ¸ ë“±ë¡
  useEffect(() => {
    console.log('ğŸ”„ [VulnerabilityScannerRace] useEffect running, arenaId:', arenaId);

    socket.emit('scannerRace:get-state');

    const handleStateData = (data: GameState) => {
      console.log('ğŸ“¥ [handleStateData] Received game state:', data);
      setGameState(data);
      setLoading(false);
    };

    const handleLeaderboardUpdate = (data: { scores: Player[] }) => {
      setGameState(prev => prev ? { ...prev, leaderboard: data.scores } : null);
    };

    const handleSubmissionSuccess = (data: any) => {
      if (alertShownRef.current) return;
      alertShownRef.current = true;

      setSubmitting(false);
      setVulnType('');
      setEndpoint('');
      setParameter('');
      setPayload('');

      // ì •ë‹µ í”¼ë“œë°± í‘œì‹œ
      const pointsText = data.pointsAwarded ? `+${data.pointsAwarded} pts` : '';
      const firstBloodText = data.isFirstBlood ? ' (First Blood!)' : '';
      toast.success(`Vulnerability found! ${pointsText}${firstBloodText}`, {
        position: 'top-center',
        autoClose: 3000,
      });

      // âœ… iframeì— ì„±ê³µ ê²°ê³¼ ì „ë‹¬
      if (iframeRef.current?.contentWindow) {
        iframeRef.current.contentWindow.postMessage({
          type: 'submission_result',
          success: true,
          message: `+${data.pointsAwarded || 0} pts${firstBloodText}`
        }, '*');
      }

      socket.emit('scannerRace:get-state');

      setTimeout(() => (alertShownRef.current = false), 500);
    };

    const handleSubmissionFailed = (data: any) => {
      console.log('ğŸ”´ [handleSubmissionFailed] Received:', data);

      // alertShownRef ì²´í¬ ì œê±° - ì˜¤ë‹µ í”¼ë“œë°±ì€ í•­ìƒ í‘œì‹œë˜ì–´ì•¼ í•¨
      setSubmitting(false);

      // ì˜¤ë‹µ í”¼ë“œë°± í‘œì‹œ
      let errorMsg = '';
      if (data.message) {
        errorMsg = data.message;
        toast.error(data.message, {
          position: 'top-center',
          autoClose: 3000,
        });
      } else if (data.pointsAwarded < 0) {
        errorMsg = `${data.pointsAwarded} pts`;
        toast.error(`Incorrect submission! ${data.pointsAwarded} pts`, {
          position: 'top-center',
          autoClose: 3000,
        });
      } else {
        errorMsg = 'Try again';
        toast.warning('Submission failed', {
          position: 'top-center',
          autoClose: 2000,
        });
      }

      // âœ… iframeì— ì‹¤íŒ¨ ê²°ê³¼ ì „ë‹¬
      if (iframeRef.current?.contentWindow) {
        iframeRef.current.contentWindow.postMessage({
          type: 'submission_result',
          success: false,
          message: errorMsg
        }, '*');
      }

      socket.emit('scannerRace:get-state');
    };

    // ìœ ì˜ˆì‹œê°„ì€ ArenaPlayPage í—¤ë”ì—ì„œ í†µí•© ê´€ë¦¬

    const handleArenaEnded = () => {
      toast.info(i18n.language === 'ko' ? 'ì•„ë ˆë‚˜ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' : 'Arena has ended!', { position: 'top-center', autoClose: 3000 });
    };

    const handleRedirectToResults = (data: { arenaId: string }) => {
      navigate(`/arena/result/${data.arenaId}`);
    };

    // âœ… ëª¨ë“  í”Œë ˆì´ì–´ ì™„ë£Œ ì•Œë¦¼
    const handleAllCompleted = (_data: { message: { ko: string; en: string } }) => {

      console.log('ğŸ‰ [VulnerabilityScannerRace] All players completed!');
      setAllCompleted(true);
    };

    const handleItemUsed = (data: {
      userId: string;
      username: string;
      itemType: string;
      value: number;
      message: string | { ko: string; en: string }
    }) => {
      const msg = typeof data.message === 'object'
        ? (i18n.language === 'ko' ? data.message.ko : data.message.en)
        : data.message;

      toast.info(msg, { position: 'top-center', autoClose: 3000 });
    };

    // âœ… ìœ ì˜ˆì‹œê°„ ì‹œì‘ í•¸ë“¤ëŸ¬ (ì´ë¯¸ ì™„ë£Œí•œ ì‚¬ëŒì€ ì œì™¸)
    const handleGracePeriodStarted = (data: { graceSec: number; message: string }) => {
      // ì´ë¯¸ ì™„ë£Œí•œ ì‚¬ìš©ìëŠ” ê²½ê³  í‘œì‹œí•˜ì§€ ì•ŠìŒ
      if (isCompletedRef.current) return;

      const graceMin = Math.floor(data.graceSec / 60);
      const graceSec = data.graceSec % 60;
      const timeStr = graceMin > 0
        ? `${graceMin}:${String(graceSec).padStart(2, '0')}`
        : `${graceSec}s`;

      const graceMessage = i18n.language === 'ko'
        ? `âš ï¸ ìœ ì˜ˆ ì‹œê°„: ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ë‚¨ì€ ì‹œê°„: ${timeStr}`
        : `âš ï¸ GRACE PERIOD: Another player completed! Time remaining: ${timeStr}`;

      toast.warning(graceMessage, {
        position: 'top-center',
        autoClose: 10000,
      });
    };

    socket.on('scannerRace:state-data', handleStateData);
    socket.on('scannerRace:scores-update', handleLeaderboardUpdate);
    socket.on('scannerRace:submission-success', handleSubmissionSuccess);
    socket.on('scannerRace:submission-failed', handleSubmissionFailed);
    socket.on('arena:ended', handleArenaEnded);
    socket.on('arena:redirect-to-results', handleRedirectToResults);
    socket.on('arena:item-used', handleItemUsed);
    socket.on('arena:grace-period-started', handleGracePeriodStarted);
    socket.on('arena:all-completed', handleAllCompleted);

    return () => {
      socket.off('scannerRace:state-data', handleStateData);
      socket.off('scannerRace:scores-update', handleLeaderboardUpdate);
      socket.off('scannerRace:submission-success', handleSubmissionSuccess);
      socket.off('scannerRace:submission-failed', handleSubmissionFailed);
      socket.off('arena:ended', handleArenaEnded);
      socket.off('arena:redirect-to-results', handleRedirectToResults);
      socket.off('arena:item-used', handleItemUsed);
      socket.off('arena:grace-period-started', handleGracePeriodStarted);
      socket.off('arena:all-completed', handleAllCompleted);
    };
  }, [arenaId, navigate, i18n.language]);

  // ğŸ”¹ iframe navigation ë°©ì§€
  useEffect(() => {
    const iframe = iframeRef.current;
    if (!iframe || !gameState?.vulnerableHTML) return;

    const handleIframeLoad = () => {
      if (!iframeLoadedRef.current) {
        iframeLoadedRef.current = true;
      } else {
        if (iframe.contentDocument) {
          iframe.contentDocument.open();
          iframe.contentDocument.write(gameState.vulnerableHTML);
          iframe.contentDocument.close();
        }
      }
    };

    iframe.addEventListener('load', handleIframeLoad);

    return () => {
      iframe.removeEventListener('load', handleIframeLoad);
      iframeLoadedRef.current = false;
    };
  }, [gameState?.vulnerableHTML]);

  // ğŸ”¹ iframe â†’ postMessage ìë™ ì œì¶œ
  useEffect(() => {
    const handleIframeMessage = (event: MessageEvent) => {
      // ì •ë‹µ ì œì¶œ (HTMLì´ ì·¨ì•½ì  ë°œê²¬ìœ¼ë¡œ íŒë‹¨)
      if (event.data.type === 'vulnerability_found') {
        if (submitting) return;

        console.log('ğŸ“© [postMessage] vulnerability_found:', event.data);
        setSubmitting(true);
        socket.emit('scannerRace:submit', {
          vulnType: event.data.vulnType,
          endpoint: event.data.endpoint || '/',
          parameter: event.data.parameter || '',
          payload: event.data.payload || ''
        });
      }

      // ì˜¤ë‹µ ì‹œë„ (HTMLì´ í‹€ë¦° ì…ë ¥ìœ¼ë¡œ íŒë‹¨) - ë°±ì—”ë“œì—ì„œ ìµœì¢… ê²€ì¦
      if (event.data.type === 'vulnerability_attempt') {
        if (submitting) return;

        console.log('ğŸ“© [postMessage] vulnerability_attempt (wrong):', event.data);
        setSubmitting(true);
        socket.emit('scannerRace:submit', {
          vulnType: event.data.vulnType,
          endpoint: event.data.endpoint || '/',
          parameter: event.data.parameter || '',
          payload: event.data.payload || ''
        });
      }
    };

    window.addEventListener('message', handleIframeMessage);
    return () => window.removeEventListener('message', handleIframeMessage);
  }, [submitting]);

  // ğŸ”¹ ëª¨ë“  ì·¨ì•½ì  ë°œê²¬ ì²´í¬ â†’ return ìœ„ë¡œ ì´ë™ (í•µì‹¬ ìˆ˜ì •)
  useEffect(() => {
    const totalVulns = gameState?.vulnerabilities?.length || 0;
    const foundVulns = gameState?.myProgress?.foundVulnerabilities?.length || 0;

    if (!gameState) return;

    if (totalVulns > 0 && foundVulns >= totalVulns && !completedShownRef.current) {
      completedShownRef.current = true;
      isCompletedRef.current = true; // âœ… ì™„ë£Œ refë„ ì—…ë°ì´íŠ¸
      setIsCompleted(true);

      toast.success('ğŸ‰ ëª¨ë“  ì·¨ì•½ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤! ìœ ì˜ˆ ì‹œê°„ ë™ì•ˆ ëŒ€ê¸°í•©ë‹ˆë‹¤...', {
        position: 'top-center',
        autoClose: 5000,
      });
    }
  }, [gameState]);

  /* ----------------------------------------------------------------
     âš ï¸ ì´ì œ ëª¨ë“  Hookì´ ìœ„ì— ìˆìœ¼ë¯€ë¡œ ì•ˆì „.
     ì—¬ê¸°ì„œë¶€í„° ì¡°ê±´ë¶€ return ê°€ëŠ¥!
  ---------------------------------------------------------------- */

  if (loading || !gameState) {
    return (
      <div className="scanner-race-container loading">
        <div className="loading-spinner">Loading Scanner Race...</div>
      </div>
    );
  }

  const myProgress = gameState.myProgress;
  const isSimulated = gameState.mode === 'SIMULATED';
  const totalVulns = gameState.vulnerabilities?.length || 0;
  const foundVulns = myProgress.foundVulnerabilities.length;

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (submitting) return;

    console.log('ğŸ“¤ [handleSubmit] Sending:', { vulnType, endpoint, parameter, payload });
    setSubmitting(true);
    socket.emit('scannerRace:submit', { vulnType, endpoint, parameter, payload });
  };

  const useHint = (vulnId: string) => {
    if (availableHints <= 0) {
      toast.warning('íŒíŠ¸ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤. ì¸ë²¤í† ë¦¬ì—ì„œ íŒíŠ¸ ì•„ì´í…œì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”!', {
        position: 'top-center',
        autoClose: 3000,
      });
      return;
    }

    const currentLevel = revealedHints.get(vulnId) || 0;
    const nextLevel = currentLevel + 1;

    const hints = gameState?.hints || [];
    const hintForVuln = hints.filter(h => h.vulnId === vulnId);
    const nextHint = hintForVuln.find(h => h.level === nextLevel);

    if (!nextHint) {
      toast.info('ë” ì´ìƒ íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.', { position: 'top-center', autoClose: 2000 });
      return;
    }

    setAvailableHints(prev => prev - 1);
    setRevealedHints(prev => new Map(prev).set(vulnId, nextLevel));

    const hintText = typeof nextHint.text === 'object'
      ? (nextHint.text[i18n.language as 'ko' | 'en'] || nextHint.text.ko || nextHint.text.en)
      : nextHint.text;

    toast.success(`ğŸ’¡ Hint ${nextLevel}: ${hintText}`, {
      position: 'top-center',
      autoClose: 8000,
    });
  };

  const getRevealedHintsForVuln = (vulnId: string): Hint[] => {
    const level = revealedHints.get(vulnId) || 0;
    const hints = gameState?.hints || [];
    return hints.filter(h => h.vulnId === vulnId && h.level <= level);
  };

  return (
    <div className="scanner-race-container">
      {/* í—¤ë” */}
      <div className="scanner-header">
        <div className="header-info">
          <h2 className="mode-title">Vulnerability Scanner Race</h2>
          <p className="target-name">
            {typeof gameState.targetName === 'object'
              ? (gameState.targetName[i18n.language as 'ko' | 'en'] || gameState.targetName.ko || gameState.targetName.en)
              : gameState.targetName}
          </p>
        </div>
        <div className="header-stats">
          <div className="stat-box">
            <span className="stat-label">SCORE</span>
            <span className="stat-value">{myProgress.score}</span>
          </div>
          <div className="stat-box">
            <span className="stat-label">VULNS</span>
            <span className="stat-value">{foundVulns}/{gameState.vulnerabilities?.length || 0}</span>
          </div>
          <div className="stat-box rank">
            <span className="stat-label">RANK</span>
            <span className="stat-value">#{myProgress.rank}</span>
          </div>
          {allCompleted && (
            <div className="stat-box all-completed">
              <span className="completion-badge">ğŸ‰ {i18n.language === 'ko' ? 'ëª¨ë‘ ì™„ë£Œ!' : 'ALL DONE!'}</span>
            </div>
          )}
        </div>
      </div>

      {/* ë©”ì¸ ì½˜í…ì¸  */}
      <div className="scanner-main">
        {/* ì™¼ìª½: íƒ€ê²Ÿ ì• í”Œë¦¬ì¼€ì´ì…˜ */}
        <div className="target-container">
          <div className="target-header">
            <div className="header-title">
              <span className="icon">â–¸</span>
              <h3>TARGET APPLICATION</h3>
              <span className="vulns-remaining">
                {foundVulns}/{gameState.vulnerabilities?.length || 0} found
              </span>
            </div>
            <p className="target-desc">
              {typeof gameState.targetDescription === 'object'
                ? (gameState.targetDescription[i18n.language as 'ko' | 'en'] || gameState.targetDescription.ko || gameState.targetDescription.en)
                : gameState.targetDescription}
            </p>
          </div>

          {isSimulated ? (
            <iframe
              ref={iframeRef}
              srcDoc={gameState.vulnerableHTML}
              sandbox="allow-scripts allow-forms allow-modals"
              className="target-iframe"
              title={t('game.vulnerableApp')}
            />
          ) : (
            <div className="target-link">
              <div className="link-box">
                <div className="url-display">
                  <span className="label">TARGET URL:</span>
                  <code className="url">{gameState.targetUrl}</code>
                </div>
                <a
                  href={gameState.targetUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="launch-btn"
                >
                  OPEN TARGET â†’
                </a>
              </div>
            </div>
          )}
        </div>

        {/* ì˜¤ë¥¸ìª½: ì •ë³´ íŒ¨ë„ */}
        <div className="info-panel">
          {/* ì·¨ì•½ì  ì²´í¬ë¦¬ìŠ¤íŠ¸ */}
          <div className="vulnerabilities-section">
            <div className="section-header">
              <span className="icon">â—‰</span>
              <h3>TARGETS</h3>
              <span className="count">{foundVulns}/{gameState.vulnerabilities?.length || 0}</span>
              {availableHints > 0 && (
                <span className="hint-count" title="ì‚¬ìš© ê°€ëŠ¥í•œ íŒíŠ¸">ğŸ’¡ {availableHints}</span>
              )}
            </div>

            <div className="vuln-list">
              {(gameState.vulnerabilities || []).map((vuln) => {
                const isFoundByMe = myProgress.foundVulnerabilities.includes(vuln.vulnId);
                const isDiscoveredBySomeone = !!vuln.discoveredBy;

                const vulnHints = (gameState.hints || []).filter(h => h.vulnId === vuln.vulnId);
                const hasHints = vulnHints.length > 0;
                const revealedLevel = revealedHints.get(vuln.vulnId) || 0;
                const maxHintLevel = Math.max(...vulnHints.map(h => h.level), 0);
                const canRevealMore = revealedLevel < maxHintLevel;
                const revealedHintsForThis = getRevealedHintsForVuln(vuln.vulnId);

                return (
                  <div
                    key={vuln.vulnId}
                    className={`vuln-item ${isFoundByMe ? 'found mine' : ''} ${
                      isDiscoveredBySomeone && !isFoundByMe ? 'found-by-other' : ''
                    }`}
                  >
                    <div className="vuln-status">
                      <span className={`status-indicator ${isFoundByMe ? 'found' : ''}`}>
                        {isFoundByMe ? 'â—' : 'â—‹'}
                      </span>
                    </div>
                    <div className="vuln-info">
                      <div className="vuln-header">
                        <div className="vuln-name">{vuln.name}</div>

                        {!isFoundByMe && hasHints && (
                          <button
                            className={`hint-btn ${canRevealMore ? '' : 'disabled'}`}
                            onClick={() => useHint(vuln.vulnId)}
                            disabled={!canRevealMore}
                          >
                            ğŸ’¡ {revealedLevel}/{maxHintLevel}
                          </button>
                        )}
                      </div>

                      <div className="vuln-meta">
                        <span className={`severity severity-${vuln.severity.toLowerCase()}`}>
                          {vuln.severity}
                        </span>
                        <span className="type">{vuln.type}</span>
                        <span className="points">+{vuln.points}</span>
                      </div>

                      {revealedHintsForThis.length > 0 && !isFoundByMe && (
                        <div className="revealed-hints">
                          {revealedHintsForThis.map((hint) => (
                            <div key={hint.hintId} className="hint-item">
                              <span className="hint-level">Hint {hint.level}:</span>
                              <span className="hint-text">
                                {typeof hint.text === 'object'
                                  ? (hint.text[i18n.language as 'ko' | 'en'] ||
                                    hint.text.ko || hint.text.en)
                                  : hint.text}
                              </span>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          {/* ì œì¶œ í¼ / ì™„ë£Œ ë©”ì‹œì§€ */}
          <div className="submit-section">
            <div className="section-header">
              <span className="icon">â–¸</span>
              <h3>{isCompleted ? 'MISSION COMPLETE' : 'REPORT FINDING'}</h3>
            </div>

            {isCompleted ? (
              <div className="completion-message">
                <div className="completion-icon">ğŸ‰</div>
                <h4>ëª¨ë“  ì·¨ì•½ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!</h4>
                <p>ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì˜ ìœ ì˜ˆ ì‹œê°„ì´ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤.</p>

                <div className="completion-stats">
                  <div className="stat">
                    <span className="label">ìµœì¢… ì ìˆ˜</span>
                    <span className="value">{myProgress.score}</span>
                  </div>
                  <div className="stat">
                    <span className="label">ë°œê²¬í•œ ì·¨ì•½ì </span>
                    <span className="value">{foundVulns}/{totalVulns}</span>
                  </div>
                  <div className="stat">
                    <span className="label">í˜„ì¬ ìˆœìœ„</span>
                    <span className="value">#{myProgress.rank}</span>
                  </div>
                </div>
              </div>
            ) : (
              <form onSubmit={handleSubmit} className="submit-form">
                <div className="form-row">
                  <div className="form-group">
                    <label>VULNERABILITY TYPE</label>
                    <select
                      value={vulnType}
                      onChange={e => setVulnType(e.target.value)}
                      required
                    >
                      <option value="">-- SELECT --</option>
                      <option value="SQLi">SQL Injection</option>
                      <option value="XSS">XSS</option>
                      <option value="CSRF">CSRF</option>
                      <option value="IDOR">IDOR</option>
                      <option value="Path Traversal">Path Traversal</option>
                      <option value="Command Injection">Command Injection</option>
                      <option value="Broken Authentication">Auth Bypass</option>
                      <option value="Security Misconfiguration">Misconfiguration</option>
                    </select>
                  </div>
                </div>

                <div className="form-row">
                  <div className="form-group">
                    <label>ENDPOINT</label>
                    <input
                      type="text"
                      value={endpoint}
                      onChange={e => setEndpoint(e.target.value)}
                      placeholder="/api/login"
                      required
                    />
                  </div>
                </div>

                <div className="form-row-split">
                  <div className="form-group">
                    <label>PARAMETER</label>
                    <input
                      type="text"
                      value={parameter}
                      onChange={e => setParameter(e.target.value)}
                      placeholder="username"
                    />
                  </div>
                  <div className="form-group">
                    <label>PAYLOAD</label>
                    <input
                      type="text"
                      value={payload}
                      onChange={e => setPayload(e.target.value)}
                      placeholder="' OR 1=1--"
                    />
                  </div>
                </div>

                <button type="submit" className="submit-btn" disabled={submitting}>
                  {submitting ? 'PROCESSING...' : 'SUBMIT REPORT'}
                </button>
              </form>
            )}
          </div>

        </div>
      </div>
    </div>
  );
};

export default VulnerabilityScannerRace;
